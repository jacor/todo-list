<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Todo-list by jacor</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Todo-list</h1>
        <p></p>

        <p class="view"><a href="https://github.com/jacor/todo-list">View the Project on GitHub <small>jacor/todo-list</small></a></p>


        <ul>
          <li><a href="https://github.com/jacor/todo-list/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/jacor/todo-list/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/jacor/todo-list">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Simple todo list on the force.com platform</h1>

<p><img src="http://www.force.com/common/assets/img/header-logo-update.png" alt="force logo"></p>

<h1>Steps To Create Application</h1>

<ul>
<li>Based on the TodoMVC App: <a href="http://todomvc.com/architecture-examples/knockoutjs/">http://todomvc.com/architecture-examples/knockoutjs/</a>
</li>
<li>Here is the code: <a href="https://github.com/addyosmani/todomvc/tree/gh-pages/architecture-examples/knockoutjs">https://github.com/addyosmani/todomvc/tree/gh-pages/architecture-examples/knockoutjs</a>
</li>
<li>Create a new developer org and assign the CEO role to the registered user</li>
<li>Create a new force.com site:

<ul>
<li>App Setup -&gt; Develop -&gt; Site -&gt; New Site </li>
<li>Site Label: todo-list, Site Name: todo_list, Active: checked</li>
<li>Use the SiteLogin.page as the site home page</li>
<li>Enable the customer portal: Customize -&gt; Customer Portal -&gt; Settings -&gt; Edit -&gt; Enable -&gt; Continue</li>
<li>Edit the customer portal, 

<ul>
<li>Set the Administrator</li>
<li>Enable Self-Registration</li>
<li>Set New User Form URL to SiteRegister</li>
<li>Set the Default New User License and Default New User Profile to High Volume Customer Portal</li>
</ul>
</li>
<li>Enable login for the site: App Setup -&gt; Develop -&gt; Site -&gt; Login Settings -&gt; Edit, set My Profile Page to MyProfilePage</li>
</ul>
</li>
</ul><h3>Register a new user on the site:</h3>

<pre><code>- Create a new account that all the registered site users will belong to. Call it TodoList Account
- Copy the Id of the account and edit the SiteRegisterController to reference the account.
- Register a new user by clicking the register link
- Add the FirstName and LastName fields to SiteRegister.page and the SiteRegisterController:
</code></pre>

<div class="highlight"><pre>    <span class="kd">public</span> <span class="n">String</span> <span class="n">lastname</span> <span class="o">{</span><span class="n">get</span><span class="o">;</span> <span class="n">set</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">firstname</span> <span class="o">{</span><span class="n">get</span><span class="o">;</span> <span class="n">set</span><span class="o">;}</span>
</pre></div>

<div class="highlight"><pre>     <span class="k">if</span><span class="o">(</span><span class="n">firstname</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">firstname</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
        <span class="n">ApexPages</span><span class="o">.</span><span class="na">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApexPages</span><span class="o">.</span><span class="na">Message</span><span class="o">(</span><span class="n">ApexPages</span><span class="o">.</span><span class="na">Severity</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="err">'</span><span class="n">Enter</span> <span class="n">a</span> <span class="n">first</span> <span class="n">name</span><span class="err">'</span><span class="o">);</span>
        <span class="n">ApexPages</span><span class="o">.</span><span class="na">addMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
         <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
     <span class="o">}</span>
     <span class="k">if</span><span class="o">(</span><span class="n">lastname</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">lastname</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
        <span class="n">ApexPages</span><span class="o">.</span><span class="na">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApexPages</span><span class="o">.</span><span class="na">Message</span><span class="o">(</span><span class="n">ApexPages</span><span class="o">.</span><span class="na">Severity</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="err">'</span><span class="n">Enter</span> <span class="n">a</span> <span class="n">last</span> <span class="n">name</span><span class="err">'</span><span class="o">);</span>
        <span class="n">ApexPages</span><span class="o">.</span><span class="na">addMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
         <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
     <span class="o">}</span>

     <span class="n">User</span> <span class="n">u</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
     <span class="n">u</span><span class="o">.</span><span class="na">Username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
     <span class="n">u</span><span class="o">.</span><span class="na">Email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
     <span class="n">u</span><span class="o">.</span><span class="na">FirstName</span> <span class="o">=</span> <span class="n">firstname</span><span class="o">;</span>
     <span class="n">u</span><span class="o">.</span><span class="na">LastName</span> <span class="o">=</span> <span class="n">lastname</span><span class="o">;</span>
     <span class="n">u</span><span class="o">.</span><span class="na">CommunityNickname</span> <span class="o">=</span> <span class="n">communityNickname</span><span class="o">;</span>
</pre></div>

<div class="highlight"><pre> <span class="nt">&lt;apex:panelGrid</span> <span class="na">columns=</span><span class="s">"2"</span> <span class="na">style=</span><span class="s">"margin-top:1em;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;apex:outputLabel</span> <span class="na">value=</span><span class="s">"{!$Label.site.username}"</span> <span class="na">for=</span><span class="s">"username"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:inputText</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">id=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"{!username}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:outputLabel</span> <span class="na">value=</span><span class="s">"First Name"</span> <span class="na">for=</span><span class="s">"firstname"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:inputText</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">id=</span><span class="s">"firstname"</span> <span class="na">value=</span><span class="s">"{!firstname}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:outputLabel</span> <span class="na">value=</span><span class="s">"Last Name"</span> <span class="na">for=</span><span class="s">"lastname"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:inputText</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">id=</span><span class="s">"lastname"</span> <span class="na">value=</span><span class="s">"{!lastname}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:outputLabel</span> <span class="na">value=</span><span class="s">"{!$Label.site.community_nickname}"</span> <span class="na">for=</span><span class="s">"communityNickname"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:inputText</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">id=</span><span class="s">"communityNickname"</span> <span class="na">value=</span><span class="s">"{!communityNickname}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:outputLabel</span> <span class="na">value=</span><span class="s">"{!$Label.site.email}"</span> <span class="na">for=</span><span class="s">"email"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:inputText</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"{!email}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:outputLabel</span> <span class="na">value=</span><span class="s">"{!$Label.site.password}"</span> <span class="na">for=</span><span class="s">"password"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:inputSecret</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"{!password}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:outputLabel</span> <span class="na">value=</span><span class="s">"{!$Label.site.confirm_password}"</span> <span class="na">for=</span><span class="s">"confirmPassword"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:inputSecret</span> <span class="na">id=</span><span class="s">"confirmPassword"</span> <span class="na">value=</span><span class="s">"{!confirmPassword}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:outputText</span> <span class="na">value=</span><span class="s">""</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;apex:commandButton</span> <span class="na">action=</span><span class="s">"{!registerUser}"</span> <span class="na">value=</span><span class="s">"{!$Label.site.submit}"</span> <span class="na">id=</span><span class="s">"submit"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/apex:panelGrid&gt;</span> 
</pre></div>

<h3>Add some nCino styling</h3>

<ul>
<li>TODO: Modify the SiteSamples/SiteStyles.css static resource to contain bootstrap styles</li>
<li>Add the nCino logos in content/images to the SiteSamples static resource in the /img folder

<ul>
<li>nCinoLogo.gif</li>
<li>nCinoLogoBars.gif</li>
</ul>
</li>
<li>Modify the generated SitePoweredBy.component to reference the nCino logo:</li>
</ul><div class="highlight"><pre><span class="nt">&lt;apex:outputLink</span> <span class="na">value=</span><span class="s">"http://www.ncino.com"</span><span class="nt">&gt;&lt;apex:image</span> <span class="na">url=</span><span class="s">"{!URLFOR($Resource.SiteSamples, 'img/nCinoLogo.png')}"</span> <span class="na">height=</span><span class="s">"55px"</span> <span class="na">styleClass=</span><span class="s">"poweredByImage"</span><span class="nt">/&gt;&lt;/apex:outputLink&gt;</span>
</pre></div>

<ul>
<li>Search and remove all files in the project that contain:</li>
</ul><div class="highlight"><pre><span class="nt">&lt;apex:image</span> <span class="na">url=</span><span class="s">"{!URLFOR($Resource.SiteSamples, 'img/clock.png')}"</span><span class="nt">/&gt;</span>
</pre></div>

<ul>
<li>Modify the image in the SiteHeader.component:</li>
</ul><div class="highlight"><pre><span class="nt">&lt;apex:image</span> <span class="na">url=</span><span class="s">"{!URLFOR($Resource.SiteSamples, 'img/nCinoLogoBars.gif')}"</span> <span class="na">style=</span><span class="s">"align: left;"</span> <span class="na">alt=</span><span class="s">"nCino"</span> <span class="na">height=</span><span class="s">"33"</span> <span class="na">title=</span><span class="s">"nCino"</span><span class="nt">/&gt;</span>
</pre></div>

<h3>Include bootstrap and other web dependencies</h3>

<ul>
<li>Create the web library dependencies (can be found in content/web_libs):

<ul>
<li>Download jquery ui: <a href="http://jqueryui.com/download/">http://jqueryui.com/download/</a>
</li>
<li>Download knockout: <a href="http://knockoutjs.com/downloads/knockout-2.2.1.js">http://knockoutjs.com/downloads/knockout-2.2.1.js</a>
</li>
<li>Download knockout-mapping: <a href="https://raw.github.com/SteveSanderson/knockout.mapping/master/build/output/knockout.mapping-latest.js">https://raw.github.com/SteveSanderson/knockout.mapping/master/build/output/knockout.mapping-latest.js</a>
</li>
<li>Download knockout-validation: <a href="https://raw.github.com/ericmbarnard/Knockout-Validation/master/Dist/knockout.validation.js">https://raw.github.com/ericmbarnard/Knockout-Validation/master/Dist/knockout.validation.js</a>
</li>
<li>Download underscore: <a href="http://underscorejs.org/underscore.js">http://underscorejs.org/underscore.js</a>
</li>
<li>Download director: <a href="https://raw.github.com/addyosmani/todomvc/gh-pages/architecture-examples/knockoutjs/components/director/build/director.js">https://raw.github.com/addyosmani/todomvc/gh-pages/architecture-examples/knockoutjs/components/director/build/director.js</a>
</li>
<li>Download TodoMvc: <a href="https://github.com/addyosmani/todomvc/tree/gh-pages/architecture-examples/knockoutjs/components/todomvc-common">https://github.com/addyosmani/todomvc/tree/gh-pages/architecture-examples/knockoutjs/components/todomvc-common</a> </li>
<li>Create a zip file from the contents: $ zip -r includes.zip * </li>
<li>Add the zip file as a static resource. Be sure to set the access level to public; call it includes</li>
<li>Create a new visualforce component that includes all the libaries; call it Includes.component:</li>
</ul>
</li>
</ul><div class="highlight"><pre>    <span class="nt">&lt;apex:component</span> <span class="nt">&gt;</span>
         <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
            <span class="nx">jQuery</span><span class="p">.</span><span class="nx">noConflict</span><span class="p">();</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/soap/ajax/27.0/connection.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/soap/ajax/27.0/apex.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>

        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'jquery-ui-1.10.2.custom/js/jquery-1.9.1.js')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'jquery-ui-1.10.2.custom/js/jquery-ui-1.10.2.custom.js')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:stylesheet</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'jquery-ui-1.10.2.custom/css/redmond/jquery-ui-1.10.2.custom.css')}"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'underscore.js')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'knockout-2.2.1.js')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'knockout.mapping-latest.js')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'knockout.validation.js')}"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'bootstrap/js/bootstrap.js')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:stylesheet</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'bootstrap/css/bootstrap.css')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:stylesheet</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'bootstrap/css/bootstrap-responsive.css')}"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'todomvc-common/base.js')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:stylesheet</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'todomvc-common/base.css')}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.includes, 'director.js')}"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;/apex:component&gt;</span>
</pre></div>

<ul>
<li>Add this component to the SiteTemplate.page and wrap all headers in a bootstrap div navbar and move the hrs tags</li>
</ul><div class="highlight"><pre><span class="nt">&lt;apex:page</span> <span class="na">showHeader=</span><span class="s">"false"</span> <span class="na">id=</span><span class="s">"SiteTemplate"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;c:Includes</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;apex:stylesheet</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.SiteSamples, 'SiteStyles.css')}"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navbar navbar-fixed-top"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"navbar-inner"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;apex:insert</span> <span class="na">name=</span><span class="s">"header"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;c:SiteHeader</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/apex:insert&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;hr/&gt;</span>
  <span class="nt">&lt;hr/&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;apex:insert</span> <span class="na">name=</span><span class="s">"body"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;apex:insert</span> <span class="na">name=</span><span class="s">"footer"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;hr/&gt;</span>
    <span class="nt">&lt;c:SiteFooter</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;site:googleAnalyticsTracking</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/apex:insert&gt;</span>
<span class="nt">&lt;/apex:page&gt;</span>
</pre></div>

<ul>
<li>Fix up the SiteLogin, ForgotPassord and SiteRegister header links in SiteHeader.component:</li>
</ul><div class="highlight"><pre>        <span class="nt">&lt;apex:outputLink</span> <span class="na">value=</span><span class="s">"SiteLogin"</span><span class="nt">&gt;</span>{!$Label.site.login_button}<span class="nt">&lt;/apex:outputLink&gt;</span>
        <span class="nt">&lt;apex:outputText</span> <span class="na">value=</span><span class="s">" | "</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:outputLink</span> <span class="na">value=</span><span class="s">"ForgotPassword"</span><span class="nt">&gt;</span>{!$Label.site.forgot_your_password_q}<span class="nt">&lt;/apex:outputLink&gt;</span>
        <span class="nt">&lt;apex:outputText</span> <span class="na">value=</span><span class="s">" | "</span> <span class="na">rendered=</span><span class="s">"{!$Site.RegistrationEnabled}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;apex:outputLink</span> <span class="na">value=</span><span class="s">"SiteRegister"</span> <span class="na">rendered=</span><span class="s">"{!$Site.RegistrationEnabled}"</span><span class="nt">&gt;</span>{!$Label.site.new_user_q}<span class="nt">&lt;/apex:outputLink&gt;</span>
      <span class="nt">&lt;/apex:panelGroup&gt;</span>
</pre></div>

<h3>Add the main web page and port the TodoMVC knockout app</h3>

<ul>
<li>Create a site home page:

<ul>
<li>Create a new visualforce page, call it TodoList.page</li>
<li>Be sure to add: showHeader="false" standardStylesheets="false" since we want our own styling</li>
<li>Also set docType="html-5.0" language="en"</li>
<li>Modify the registerUser method of the SiteRegisterController &amp; SiteLoginControllers to pass in the page URL of the TodoList.page to the login() call</li>
<li>Add the page to the site: App Setup -&gt; Develop -&gt; Sites -&gt; Site visualforce pages -&gt; Edit</li>
</ul>
</li>
</ul><div class="highlight"><pre><span class="nt">&lt;apex:page</span> <span class="na">showHeader=</span><span class="s">"false"</span> <span class="na">standardStylesheets=</span><span class="s">"false"</span> <span class="na">docType=</span><span class="s">"html-5.0"</span> <span class="na">language=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;apex:composition</span> <span class="na">template=</span><span class="s">"{!$Site.Template}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;apex:define</span> <span class="na">name=</span><span class="s">"body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div&gt;</span>
                insert content here
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/apex:define&gt;</span>
    <span class="nt">&lt;/apex:composition&gt;</span>
<span class="nt">&lt;/apex:page&gt;</span>
</pre></div>

<div class="highlight"><pre>    <span class="k">return</span> <span class="n">Site</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="err">'</span><span class="o">/</span><span class="n">TodoList</span><span class="err">'</span><span class="o">);</span>
</pre></div>

<ul>
<li>Create a ToDo Component

<ul>
<li>Create a js file called app.js and upload it as a static resource. </li>
<li>Copy in the knockout code for the todo app.js; be sure to wrap it in jQuery(function(){}); to allow for a ready DOM</li>
<li>Inlcude the app.js script in the ToDo component</li>
</ul>
</li>
</ul><div class="highlight"><pre><span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.app)}"</span> <span class="nt">/&gt;</span>
</pre></div>

<ul>
<li>Copy in todo html code into ToDo component

<ul>
<li>remove the base.css stylesheet include in the head tag</li>
<li>remove the js include tags at the bottom of the file</li>
<li>find autofocus and set it to autofocus="true"</li>
<li>find all input and meta tags and be sure to end them</li>
<li>Modify the TodoList.page to include the Todo.component </li>
</ul>
</li>
</ul><div class="highlight"><pre><span class="nt">&lt;apex:component&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">"IE=edge,chrome=1"</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;title&gt;</span>Knockout.js • TodoMVC<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body</span> <span class="na">id=</span><span class="s">"todolistapp"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"todoapp"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;header</span> <span class="na">id=</span><span class="s">"header"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h1&gt;</span>todos<span class="nt">&lt;/h1&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"new-todo"</span> <span class="na">data-bind=</span><span class="s">"value: current, valueUpdate: 'afterkeydown', enterKey: add"</span> <span class="na">placeholder=</span><span class="s">"What needs to be done?"</span> <span class="na">autofocus=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/header&gt;</span>
            <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"main"</span> <span class="na">data-bind=</span><span class="s">"visible: todos().length"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"toggle-all"</span> <span class="na">data-bind=</span><span class="s">"checked: allCompleted"</span> <span class="na">type=</span><span class="s">"checkbox"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"toggle-all"</span><span class="nt">&gt;</span>Mark all as complete<span class="nt">&lt;/label&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"todo-list"</span> <span class="na">data-bind=</span><span class="s">"foreach: filteredTodos"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li</span> <span class="na">data-bind=</span><span class="s">"css: { completed: completed, editing: editing }"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"view"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"toggle"</span> <span class="na">data-bind=</span><span class="s">"checked: completed"</span> <span class="na">type=</span><span class="s">"checkbox"</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;label</span> <span class="na">data-bind=</span><span class="s">"text: title, event: { dblclick: $root.editItem }"</span><span class="nt">&gt;&lt;/label&gt;</span>
                            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"destroy"</span> <span class="na">data-bind=</span><span class="s">"click: $root.remove"</span><span class="nt">&gt;&lt;/button&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"edit"</span> <span class="na">data-bind=</span><span class="s">"value: title, valueUpdate: 'afterkeydown', enterKey: $root.stopEditing, selectAndFocus: editing, event: { blur: $root.stopEditing }"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/section&gt;</span>
            <span class="nt">&lt;footer</span> <span class="na">id=</span><span class="s">"footer"</span> <span class="na">data-bind=</span><span class="s">"visible: completedCount() || remainingCount()"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"todo-count"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;strong</span> <span class="na">data-bind=</span><span class="s">"text: remainingCount"</span><span class="nt">&gt;</span>0<span class="nt">&lt;/strong&gt;</span>
                    <span class="nt">&lt;span</span> <span class="na">data-bind=</span><span class="s">"text: getLabel( remainingCount )"</span><span class="nt">&gt;&lt;/span&gt;</span> left
                <span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"filters"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">data-bind=</span><span class="s">"css: { selected: showMode() == 'all' }"</span> <span class="na">href=</span><span class="s">"#/all"</span><span class="nt">&gt;</span>All<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">data-bind=</span><span class="s">"css: { selected: showMode() == 'active' }"</span> <span class="na">href=</span><span class="s">"#/active"</span><span class="nt">&gt;</span>Active<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">data-bind=</span><span class="s">"css: { selected: showMode() == 'completed' }"</span> <span class="na">href=</span><span class="s">"#/completed"</span><span class="nt">&gt;</span>Completed<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"clear-completed"</span> <span class="na">data-bind=</span><span class="s">"visible: completedCount, click: removeCompleted"</span><span class="nt">&gt;</span>
                    Clear completed (<span class="nt">&lt;span</span> <span class="na">data-bind=</span><span class="s">"text: completedCount"</span><span class="nt">&gt;&lt;/span&gt;</span>)
                <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/footer&gt;</span>
        <span class="nt">&lt;/section&gt;</span>
        <span class="nt">&lt;footer</span> <span class="na">id=</span><span class="s">"info"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;</span>Double-click to edit a todo<span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;</span>Original Knockout version from <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://github.com/ashish01/knockoutjs-todos"</span><span class="nt">&gt;</span>Ashish Sharma<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;</span>Rewritten to use Knockout 2.0 and standard template by <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://knockmeout.net"</span><span class="nt">&gt;</span>Ryan Niemeyer<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;</span>Patches/fixes for cross-browser compat: <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://twitter.com/addyosmani"</span><span class="nt">&gt;</span>Addy Osmani<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;</span>Part of <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://todomvc.com"</span><span class="nt">&gt;</span>TodoMVC<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/footer&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;apex:includeScript</span> <span class="na">value=</span><span class="s">"{!URLFOR($Resource.app)}"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/apex:component&gt;</span>
</pre></div>

<h3>Test the ported app:</h3>

<ul>
<li>Login as the user and test the basic todo list.

<ul>
<li>add some todo items</li>
<li>items are stored in a local cookie</li>
<li>log out and log back in</li>
</ul>
</li>
</ul><h3>Enhance the app to persist todo item in salesforce</h3>

<ul>
<li>Create a database table (or sObject aka Schema-Object) in salesforce to save our data.

<ul>
<li>App Setup -&gt; Create -&gt; Objects -&gt; New Custom Object</li>
<li>Call the object ToDo List, set the following fields (that corresponds with the Todo js model):

<ul>
<li>Name: Autonumber</li>
<li>Title: Text, Requried, 255</li>
<li>Completed: Boolean </li>
</ul>
</li>
</ul>
</li>
<li>Create a POJO value object that contains all data required for the UI model (data structure matches the Todo js model):</li>
</ul><div class="highlight"><pre>    <span class="kd">public</span> <span class="n">with</span> <span class="n">sharing</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">recordId</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">Boolean</span> <span class="n">completed</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">Boolean</span> <span class="n">editing</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<ul>
<li>Change the Todo js model to set the completed &amp; recordId variables if they are not set:</li>
</ul><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">Todo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">recordId</span><span class="p">,</span> <span class="nx">completed</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">recordId</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">recordId</span> <span class="o">==</span> <span class="kc">null</span><span class="o">?</span> <span class="s1">''</span> <span class="o">:</span> <span class="nx">recordId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">completed</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">completed</span> <span class="o">==</span> <span class="kc">null</span><span class="o">?</span> <span class="kc">false</span><span class="o">:</span> <span class="nx">completed</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">editing</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span>
</pre></div>

<ul>
<li>Modify the initialization of the self.todos observable array to set the additional constructor variable:</li>
</ul><div class="highlight"><pre>    <span class="nx">self</span><span class="p">.</span><span class="nx">todos</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observableArray</span><span class="p">(</span><span class="nx">ko</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">arrayMap</span><span class="p">(</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Todo</span><span class="p">(</span><span class="nx">todo</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">recordId</span><span class="p">,</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">completed</span><span class="p">);</span>
    <span class="p">}));</span>

</pre></div>

<ul>
<li>Create a APEX Remoting JS Service to CRUD the Todo list, call the class TodoListService.

<ul>
<li>Modify the Todo.component and set the controller attribute to TodoListService</li>
<li>add 2 @RemoteAction methods to this class: 1) getTodoList and 2) saveTodoList</li>
</ul>
</li>
</ul><div class="highlight"><pre>    <span class="kd">public</span> <span class="n">with</span> <span class="n">sharing</span> <span class="kd">class</span> <span class="nc">TodoListService</span> <span class="o">{</span>
        <span class="nd">@RemoteAction</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="n">Todo</span><span class="o">[]</span> <span class="nf">getTodoList</span><span class="o">(){</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@RemoteAction</span> 
        <span class="kd">public</span> <span class="kd">static</span> <span class="n">Todo</span><span class="o">[]</span> <span class="nf">saveTodoList</span><span class="o">(</span><span class="n">Todo</span><span class="o">[]</span> <span class="n">todoList</span><span class="o">){</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></div>

<ul>
<li>Add the implementation for the TodoListService methods</li>
<li>the getTodoList() implementation is straight forward</li>
</ul><div class="highlight"><pre>    <span class="nd">@RemoteAction</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Todo</span><span class="o">[]</span> <span class="nf">getTodoList</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">retrieveTodoList</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Todo</span><span class="o">[]</span> <span class="nf">retrieveTodoList</span><span class="o">(){</span>
        <span class="n">Todo</span><span class="o">[]</span> <span class="n">todoList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Todo</span><span class="o">[]{};</span>
        <span class="n">ToDo_List__c</span><span class="o">[]</span> <span class="n">records</span> <span class="o">=</span> <span class="n">retrieveListFromDb</span><span class="o">(</span><span class="n">UserInfo</span><span class="o">.</span><span class="na">getUserId</span><span class="o">());</span>

        <span class="k">for</span><span class="o">(</span><span class="n">ToDo_List__c</span> <span class="n">l</span> <span class="o">:</span> <span class="n">records</span><span class="o">){</span>
            <span class="n">Todo</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Todo</span><span class="o">();</span>
            <span class="n">mapFromDbRecord</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
            <span class="n">todoList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">todoList</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">mapFromDbRecord</span><span class="o">(</span><span class="n">ToDo_List__c</span> <span class="n">dbRecord</span><span class="o">,</span> <span class="n">Todo</span> <span class="n">t</span><span class="o">){</span>
        <span class="n">t</span><span class="o">.</span><span class="na">recordId</span> <span class="o">=</span> <span class="n">dbRecord</span><span class="o">.</span><span class="na">Id</span><span class="o">;</span>
        <span class="n">t</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">dbRecord</span><span class="o">.</span><span class="na">Title__c</span><span class="o">;</span>
        <span class="n">t</span><span class="o">.</span><span class="na">completed</span> <span class="o">=</span> <span class="n">dbRecord</span><span class="o">.</span><span class="na">Completed__c</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ToDo_List__c</span><span class="o">[]</span> <span class="nf">retrieveListFromDb</span><span class="o">(</span><span class="n">Id</span> <span class="n">userId</span><span class="o">){</span>
        <span class="k">return</span> <span class="o">[</span>    
            <span class="n">SELECT</span> 
                <span class="n">Id</span><span class="o">,</span> 
                <span class="n">Title__c</span><span class="o">,</span> 
                <span class="n">Completed__c</span>
            <span class="n">FROM</span> 
                <span class="n">ToDo_List__c</span>
            <span class="n">WHERE</span>
                <span class="n">OwnerId</span> <span class="o">=:</span> <span class="n">userId</span>
            <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">CreatedDate</span> <span class="n">ASC</span><span class="o">];</span>
    <span class="o">}</span>
</pre></div>

<ul>
<li>the saveTodoList() implementation is tricky:
<pre>
Cruds the todo list by examining the recordId field of the Todo items in the following way:

</pre>
<ul>
<li>if the recordId matches the record Id in the database then update the record</li>
<li>if the Todo item does not have a recordId then add it to the database</li>
<li>remove the remaining items in the list (that were not added/removed) 
</li>
</ul>
</li>
</ul><div class="highlight"><pre>    <span class="nd">@RemoteAction</span> 
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Todo</span><span class="o">[]</span> <span class="nf">saveTodoList</span><span class="o">(</span><span class="n">Todo</span><span class="o">[]</span> <span class="n">todoList</span><span class="o">){</span>
        <span class="n">saveTodoListToDb</span><span class="o">(</span><span class="n">todoList</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">getTodoList</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**</span>
<span class="cm">    * Cruds the todo list by examining the recordId field of the Todo items in the following way:</span>
<span class="cm">    * &lt;ul&gt;</span>
<span class="cm">    * &lt;li&gt;if the recordId matches the record Id in the database then update the record&lt;/li&gt;</span>
<span class="cm">    * &lt;li&gt;if the Todo item does not have a recordId then add it to the database&lt;/li&gt;</span>
<span class="cm">    * &lt;li&gt;Remove the remaining items in the list (that were not added/removed)&lt;/li&gt;</span>
<span class="cm">    * &lt;/ul&gt; </span>
<span class="cm">    */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saveTodoListToDb</span><span class="o">(</span><span class="n">Todo</span><span class="o">[]</span> <span class="n">todoList</span><span class="o">){</span>
        <span class="n">ToDo_List__c</span><span class="o">[]</span> <span class="n">insertList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ToDo_List__c</span><span class="o">[]{};</span>
        <span class="n">ToDo_List__c</span><span class="o">[]</span> <span class="n">updateList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ToDo_List__c</span><span class="o">[]{};</span>
        <span class="n">ToDo_List__c</span><span class="o">[]</span> <span class="n">deleteList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ToDo_List__c</span><span class="o">[]{};</span>


        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Id</span><span class="o">,</span><span class="n">ToDo_List__c</span><span class="o">&gt;</span> <span class="n">records</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Id</span><span class="o">,</span><span class="n">ToDo_List__c</span><span class="o">&gt;(</span>
            <span class="n">retrieveListFromDb</span><span class="o">(</span>
            <span class="n">UserInfo</span><span class="o">.</span><span class="na">getUserId</span><span class="o">());</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Integer</span> <span class="n">i</span><span class="o">=</span><span class="n">todoList</span><span class="o">.</span><span class="na">size</span><span class="o">()-</span><span class="mi">1</span><span class="o">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">--){</span>
            <span class="n">Todo</span> <span class="n">t</span> <span class="o">=</span> <span class="n">todoList</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="k">if</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">recordId</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">t</span><span class="o">.</span><span class="na">recordId</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
                <span class="n">ToDo_List__c</span> <span class="n">dbRecord</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">recordId</span><span class="o">);</span> <span class="c1">// remove from list</span>
                <span class="k">if</span><span class="o">(</span><span class="n">dbRecord</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                    <span class="n">mapToDbRecord</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">dbRecord</span><span class="o">);</span>
                    <span class="n">updateList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">dbRecord</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">else</span><span class="o">{</span>
                <span class="n">ToDo_List__c</span> <span class="n">newTodo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ToDo_List__c</span><span class="o">();</span>
                <span class="n">mapToDbRecord</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">newTodo</span><span class="o">);</span>
                <span class="n">insertList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">newTodo</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">deleteList</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">records</span><span class="o">.</span><span class="na">values</span><span class="o">());</span>

        <span class="n">Database</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">insertList</span><span class="o">);</span>
        <span class="n">Database</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">updateList</span><span class="o">);</span>
        <span class="n">Database</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">deleteList</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">mapToDbRecord</span><span class="o">(</span><span class="n">Todo</span> <span class="n">t</span><span class="o">,</span> <span class="n">ToDo_List__c</span> <span class="n">dbRecord</span><span class="o">){</span>
        <span class="n">dbRecord</span><span class="o">.</span><span class="na">Title__c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
        <span class="n">dbRecord</span><span class="o">.</span><span class="na">Completed__c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">completed</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<ul>
<li>Create testcases for CRUD operations</li>
<li>Create 2 new apex remoting js functions at the bottom of the ToDo.component that invoke the remote actions:</li>
</ul><div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">loadTodoList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">Visualforce</span><span class="p">.</span><span class="nx">remoting</span><span class="p">.</span><span class="nx">Manager</span><span class="p">.</span><span class="nx">invokeAction</span><span class="p">(</span>
            <span class="s1">'{!$RemoteAction.TodoListService.getTodoList}'</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">event</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">'exception'</span><span class="p">){</span>
                     <span class="nx">alert</span><span class="p">(</span><span class="s1">'Your session has timed out.'</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">status</span><span class="p">){</span>
                    <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">result</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">else</span><span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">);</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span><span class="nx">escape</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span> <span class="p">);</span>
    <span class="p">};</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">persistTodoList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
        <span class="nx">Visualforce</span><span class="p">.</span><span class="nx">remoting</span><span class="p">.</span><span class="nx">Manager</span><span class="p">.</span><span class="nx">invokeAction</span><span class="p">(</span>
            <span class="s1">'{!$RemoteAction.TodoListService.saveTodoList}'</span><span class="p">,</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">ko</span><span class="p">.</span><span class="nx">toJS</span><span class="p">(</span><span class="nx">todos</span><span class="p">()),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">list</span><span class="p">){</span>
                <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
            <span class="p">}),</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">event</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">'exception'</span><span class="p">){</span>
                     <span class="nx">alert</span><span class="p">(</span><span class="s1">'Your session has timed out.'</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">status</span><span class="p">){</span>
                    <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">result</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">else</span><span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">);</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span><span class="nx">escape</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span> <span class="p">);</span>
    <span class="p">};</span>
</pre></div>

<ul>
<li>Modify the app.resource to load the data from the TodoListService:</li>
</ul><div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">loadTodoList</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">todos</span><span class="p">){</span>
        <span class="c1">// bind a new instance of our view model to the page</span>
        <span class="kd">var</span> <span class="nx">viewModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="nx">todos</span> <span class="o">||</span> <span class="p">[]);</span>
        <span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindings</span><span class="p">(</span><span class="nx">viewModel</span><span class="p">);</span>

        <span class="c1">// set up filter routing</span>
        <span class="cm">/*jshint newcap:false */</span>
        <span class="nx">Router</span><span class="p">({</span><span class="s1">'/:filter'</span><span class="o">:</span> <span class="nx">viewModel</span><span class="p">.</span><span class="nx">showMode</span><span class="p">}).</span><span class="nx">init</span><span class="p">();</span>
    <span class="p">});</span>
</pre></div>

<ul>
<li>Modify the app.resource to save and reload-rebind the data from the TodoListService:</li>
</ul><div class="highlight"><pre>    <span class="c1">// internal computed observable that fires whenever anything changes in our todos</span>
    <span class="nx">ko</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">persistTodoList</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">todos</span><span class="p">){</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">list</span><span class="p">){</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">todos</span><span class="p">(),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">innerElement</span><span class="p">,</span> <span class="nx">innerIndex</span><span class="p">,</span> <span class="nx">innerList</span><span class="p">){</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">title</span> <span class="o">==</span> <span class="nx">innerElement</span><span class="p">.</span><span class="nx">title</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
                            <span class="nx">element</span><span class="p">.</span><span class="nx">recordId</span> <span class="o">!=</span> <span class="nx">innerElement</span><span class="p">.</span><span class="nx">recordId</span><span class="p">()){</span>
                        <span class="nx">innerElement</span><span class="p">.</span><span class="nx">recordId</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">recordId</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">}).</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">throttle</span><span class="o">:</span> <span class="mi">500</span>
    <span class="p">});</span> <span class="c1">// save at most twice per second</span>
</pre></div>

<h3>Test the app and observe the todos being saved to the database</h3>

<h3>Combine the Todo list with a salesforce contact:</h3>

<ul>
<li>Add a contact lookup column to the ToDo List database table</li>
<li>Modify the TodoListService to set this contact field for every new record.

<ul>
<li>The User table has column for ContactId</li>
</ul>
</li>
<li>Modify the contact page layout to add the TodoList related list and add the relevant columns</li>
<li>At this point each todo list item is assigned to the contact that created the issue.

<ul>
<li>Let's add the ability to assign the todo list item to another user</li>
<li>Add a POJO to house the data</li>
</ul>
</li>
</ul><div class="highlight"><pre>    <span class="kd">public</span> <span class="n">with</span> <span class="n">sharing</span> <span class="kd">class</span> <span class="nc">TodoContact</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">recordId</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<ul>
<li>compose this in the Todo record:</li>
</ul><div class="highlight"><pre>    <span class="kd">public</span> <span class="n">with</span> <span class="n">sharing</span> <span class="kd">class</span> <span class="nc">Todo</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">recordId</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">Boolean</span> <span class="n">completed</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">Boolean</span> <span class="n">editing</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">TodoContact</span> <span class="n">assignee</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<ul>
<li>add a new @RemoteAction to the TodoListService to retrieve all contacts</li>
</ul><div class="highlight"><pre>    <span class="nd">@RemoteAction</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">TodoContact</span><span class="o">[]</span> <span class="nf">getContacts</span><span class="o">(){</span>
        <span class="n">TodoContact</span><span class="o">[]</span> <span class="n">toReturn</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoContact</span><span class="o">[]{};</span>
        <span class="n">Contact</span><span class="o">[]</span> <span class="n">contacts</span> <span class="o">=</span> <span class="o">[</span><span class="n">SELECT</span> <span class="n">Id</span><span class="o">,</span> <span class="n">Name</span> <span class="n">FROM</span> <span class="n">Contact</span><span class="o">];</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Contact</span> <span class="n">c</span> <span class="o">:</span> <span class="n">contacts</span><span class="o">){</span>
            <span class="n">TodoContact</span> <span class="n">tContact</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoContact</span><span class="o">();</span>
            <span class="n">tContact</span><span class="o">.</span><span class="na">recordId</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">Id</span><span class="o">;</span>
            <span class="n">tContact</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">Name</span><span class="o">;</span>
            <span class="n">toReturn</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">tContact</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">toReturn</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<ul>
<li>Add a Apex Remoting function to invoke the service:</li>
</ul><div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">loadContacts</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">Visualforce</span><span class="p">.</span><span class="nx">remoting</span><span class="p">.</span><span class="nx">Manager</span><span class="p">.</span><span class="nx">invokeAction</span><span class="p">(</span>
            <span class="s1">'{!$RemoteAction.TodoListService.getContacts}'</span><span class="p">,</span>
            <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">event</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">'exception'</span><span class="p">){</span>
                     <span class="nx">alert</span><span class="p">(</span><span class="s1">'Your session has timed out.'</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">status</span><span class="p">){</span>
                    <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">result</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">else</span><span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">);</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span><span class="nx">escape</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span> <span class="p">);</span>
    <span class="p">};</span>
</pre></div>

<ul>
<li>Modify the TodoList service to load the contact id and name in the load from db call</li>
<li>Also, modify the mapFromDbRecord and mapToDbRecord methods to set the contact to the assignee it is set</li>
</ul><div class="highlight"><pre>    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">mapToDbRecord</span><span class="o">(</span><span class="n">Todo</span> <span class="n">t</span><span class="o">,</span> <span class="n">ToDo_List__c</span> <span class="n">dbRecord</span><span class="o">){</span>
        <span class="n">dbRecord</span><span class="o">.</span><span class="na">Title__c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
        <span class="n">dbRecord</span><span class="o">.</span><span class="na">Completed__c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">completed</span><span class="o">;</span>
        <span class="n">dbRecord</span><span class="o">.</span><span class="na">Contact__c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">assignee</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> 
            <span class="n">t</span><span class="o">.</span><span class="na">assignee</span><span class="o">.</span><span class="na">recordId</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">t</span><span class="o">.</span><span class="na">assignee</span><span class="o">.</span><span class="na">recordId</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">mapFromDbRecord</span><span class="o">(</span><span class="n">ToDo_List__c</span> <span class="n">dbRecord</span><span class="o">,</span> <span class="n">Todo</span> <span class="n">t</span><span class="o">){</span>
        <span class="n">t</span><span class="o">.</span><span class="na">recordId</span> <span class="o">=</span> <span class="n">dbRecord</span><span class="o">.</span><span class="na">Id</span><span class="o">;</span>
        <span class="n">t</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">dbRecord</span><span class="o">.</span><span class="na">Title__c</span><span class="o">;</span>
        <span class="n">t</span><span class="o">.</span><span class="na">completed</span> <span class="o">=</span> <span class="n">dbRecord</span><span class="o">.</span><span class="na">Completed__c</span><span class="o">;</span>
        <span class="n">t</span><span class="o">.</span><span class="na">assignee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodoContact</span><span class="o">();</span>
        <span class="n">t</span><span class="o">.</span><span class="na">assignee</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">dbRecord</span><span class="o">.</span><span class="na">Contact__r</span><span class="o">.</span><span class="na">Name</span><span class="o">;</span>
        <span class="n">t</span><span class="o">.</span><span class="na">assignee</span><span class="o">.</span><span class="na">recordId</span> <span class="o">=</span> <span class="n">dbRecord</span><span class="o">.</span><span class="na">Contact__r</span><span class="o">.</span><span class="na">Id</span><span class="o">;</span>
    <span class="o">}</span>   
</pre></div>

<ul>
<li>Ensure that the Contact__c is set to the contact o the logged in user when an assignee is not provided</li>
<li>Modify the TodoListService todo record selection retrieval criteria to include items in the list that are assigned to the user</li>
</ul><div class="highlight"><pre>    <span class="n">ToDo_List__c</span> <span class="n">newTodo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ToDo_List__c</span><span class="o">();</span>
    <span class="n">mapToDbRecord</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">newTodo</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">newTodo</span><span class="o">.</span><span class="na">Contact__c</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
        <span class="n">newTodo</span><span class="o">.</span><span class="na">Contact__c</span> <span class="o">=</span> <span class="n">contactId</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">insertList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">newTodo</span><span class="o">);</span>
</pre></div>

<div class="highlight"><pre>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ToDo_List__c</span><span class="o">[]</span> <span class="nf">retrieveListFromDb</span><span class="o">(</span><span class="n">Id</span> <span class="n">userId</span><span class="o">,</span> <span class="n">Id</span> <span class="n">contactId</span><span class="o">){</span>
        <span class="k">return</span> <span class="o">[</span>    
            <span class="n">SELECT</span> 
                <span class="n">Id</span><span class="o">,</span> 
                <span class="n">Title__c</span><span class="o">,</span> 
                <span class="n">Completed__c</span><span class="o">,</span>
                <span class="n">Contact__r</span><span class="o">.</span><span class="na">Id</span><span class="o">,</span>
                <span class="n">Contact__r</span><span class="o">.</span><span class="na">Name</span>
            <span class="n">FROM</span> 
                <span class="n">ToDo_List__c</span>
            <span class="n">WHERE</span>
                <span class="n">OwnerId</span> <span class="o">=:</span> <span class="n">userId</span>
            <span class="n">OR</span>
                <span class="n">Contact__c</span> <span class="o">=:</span> <span class="n">contactId</span>
            <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">CreatedDate</span> <span class="n">ASC</span><span class="o">];</span>
    <span class="o">}</span>
</pre></div>

<ul>
<li>Make the corresponding js model changes to accomodate the assignee:</li>
</ul><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">TodoContact</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">recordId</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">recordId</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">recordId</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// represent a single todo item</span>
    <span class="kd">var</span> <span class="nx">Todo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">recordId</span><span class="p">,</span> <span class="nx">completed</span><span class="p">,</span> <span class="nx">assignee</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">recordId</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">recordId</span> <span class="o">==</span> <span class="kc">null</span><span class="o">?</span> <span class="s1">''</span> <span class="o">:</span> <span class="nx">recordId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">completed</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">completed</span> <span class="o">==</span> <span class="kc">null</span><span class="o">?</span> <span class="kc">false</span><span class="o">:</span> <span class="nx">completed</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">editing</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">assignee</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="nx">assignee</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="c1">// map array of passed in todos to an observableArray of Todo objects</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">todos</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observableArray</span><span class="p">(</span><span class="nx">ko</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">arrayMap</span><span class="p">(</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">todo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Todo</span><span class="p">(</span>
                <span class="nx">todo</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> 
                <span class="nx">todo</span><span class="p">.</span><span class="nx">recordId</span><span class="p">,</span> 
                <span class="nx">todo</span><span class="p">.</span><span class="nx">completed</span><span class="p">,</span> 
                <span class="k">new</span> <span class="nx">TodoContact</span><span class="p">(</span>
                        <span class="nx">todo</span><span class="p">.</span><span class="nx">assignee</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> 
                        <span class="nx">todo</span><span class="p">.</span><span class="nx">assignee</span><span class="p">.</span><span class="nx">recordId</span><span class="p">));</span>
    <span class="p">}));</span>
</pre></div>

<ul>
<li>We also need to make sure that the assignee observable is set correctly from the response:</li>
</ul><div class="highlight"><pre>    <span class="c1">// internal computed observable that fires whenever anything changes in our todos</span>
    <span class="nx">ko</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">persistTodoList</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">todos</span><span class="p">){</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">list</span><span class="p">){</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">todos</span><span class="p">(),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">innerElement</span><span class="p">,</span> <span class="nx">innerIndex</span><span class="p">,</span> <span class="nx">innerList</span><span class="p">){</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">title</span> <span class="o">==</span> <span class="nx">innerElement</span><span class="p">.</span><span class="nx">title</span><span class="p">()</span> <span class="o">&amp;&amp;</span> 
                            <span class="nx">element</span><span class="p">.</span><span class="nx">recordId</span> <span class="o">!=</span> <span class="nx">innerElement</span><span class="p">.</span><span class="nx">recordId</span><span class="p">()){</span>

                        <span class="nx">innerElement</span><span class="p">.</span><span class="nx">recordId</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">recordId</span><span class="p">);</span>
                        <span class="nx">innerElement</span><span class="p">.</span><span class="nx">assignee</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">assignee</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">}).</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">throttle</span><span class="o">:</span> <span class="mi">500</span>
    <span class="p">});</span> <span class="c1">// save at most twice per second</span>
</pre></div>

<ul>
<li>Create a new observable for the contacts:</li>
</ul><div class="highlight"><pre>    <span class="nx">self</span><span class="p">.</span><span class="nx">contacts</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observableArray</span><span class="p">([]);</span>
</pre></div>

<ul>
<li>load the contacts when the app is initialized</li>
</ul><div class="highlight"><pre>    <span class="p">....</span>
    <span class="p">....</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">reloadContacts</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">loadContacts</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">contacts</span><span class="p">){</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">contacts</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">list</span><span class="p">){</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">contacts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">TodoContact</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">element</span><span class="p">.</span><span class="nx">recordId</span><span class="p">));</span>
                <span class="p">});</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">loadTodoList</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">todos</span><span class="p">){</span>
        <span class="c1">// bind a new instance of our view model to the page</span>
        <span class="kd">var</span> <span class="nx">viewModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="nx">todos</span> <span class="o">||</span> <span class="p">[]);</span>
        <span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindings</span><span class="p">(</span><span class="nx">viewModel</span><span class="p">);</span>

        <span class="c1">// set up filter routing</span>
        <span class="cm">/*jshint newcap:false */</span>
        <span class="nx">Router</span><span class="p">({</span><span class="s1">'/:filter'</span><span class="o">:</span> <span class="nx">viewModel</span><span class="p">.</span><span class="nx">showMode</span><span class="p">}).</span><span class="nx">init</span><span class="p">();</span>

        <span class="c1">// load contacts</span>
        <span class="nx">viewModel</span><span class="p">.</span><span class="nx">reloadContacts</span><span class="p">();</span>
    <span class="p">});</span>
</pre></div>

<ul>
<li>Add a function to assign the selected user to the todo list item:</li>
</ul><div class="highlight"><pre>    <span class="nx">self</span><span class="p">.</span><span class="nx">assignContact</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">todo</span><span class="p">,</span> <span class="nx">contact</span><span class="p">){</span>
        <span class="nx">todo</span><span class="p">.</span><span class="nx">assignee</span><span class="p">(</span><span class="nx">contact</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>

<ul>
<li>Let's add the assignee control to the todo list (be sure to add it inside the view div):</li>
</ul><div class="highlight"><pre>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"btn-group assignee"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-mini"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"icon-user icon-white"</span><span class="nt">&gt;&lt;/i&gt;</span> <span class="nt">&lt;span</span> <span class="na">data-bind=</span><span class="s">"text: assignee() != null ? assignee().name : ''"</span><span class="nt">&gt;&lt;/span&gt;&lt;/a&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-mini dropdown-toggle"</span> <span class="na">data-toggle=</span><span class="s">"dropdown"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">"caret"</span><span class="nt">&gt;&lt;/span&gt;&lt;/a&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"dropdown-menu"</span> <span class="na">data-bind=</span><span class="s">"foreach: {data: $root.contacts, as: 'contact'}"</span><span class="nt">&gt;</span>
             <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">data-bind=</span><span class="s">"click: $root.assignContact.bind($data, todo, contact)"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"icon-hand-up"</span><span class="nt">&gt;&lt;/i&gt;</span> <span class="nt">&lt;span</span> <span class="na">data-bind=</span><span class="s">"text: name"</span><span class="nt">&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"assignee-readonly"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"icon-user icon-black"</span><span class="nt">&gt;&lt;/i&gt;</span> <span class="nt">&lt;span</span> <span class="na">data-bind=</span><span class="s">"text: assignee() != null ? assignee().name : ''"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
</pre></div>

<ul>
<li>
<p>The filteredTodos foreach should be changed to specify the alias:</p>

<div class="highlight"><pre>foreach: {data: filteredTodos, as: 'todo'}
</pre></div>
</li>
<li><p>Wire it into the click event on the select-list:</p></li>
</ul><div class="highlight"><pre>    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">data-bind=</span><span class="s">"click: $root.assignContact.bind($data, todo, contact)"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"icon-hand-up"</span><span class="nt">&gt;&lt;/i&gt;</span> <span class="nt">&lt;span</span> <span class="na">data-bind=</span><span class="s">"text: name"</span><span class="nt">&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span>
</pre></div>

<ul>
<li>We should style the assignee drop down to make it seem more integrated and only allow changing the assignee for uncompleted tasks:</li>
<li>Change the body styling to body#todoappbody</li>
</ul><div class="highlight"><pre>    <span class="nf">#todo-list</span> <span class="nt">li</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee</span><span class="p">{</span>
        <span class="k">display</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span><span class="nc">.completed</span><span class="nd">:hover</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee</span><span class="p">{</span>
        <span class="k">display</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span><span class="nd">:hover</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee</span><span class="p">{</span>
        <span class="k">display</span><span class="o">:</span> <span class="k">block</span><span class="p">;</span>
        <span class="k">font-size</span><span class="o">:</span> <span class="m">14px</span><span class="p">;</span>
        <span class="k">margin-left</span><span class="o">:</span> <span class="m">45px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span><span class="nd">:hover</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee</span> <span class="nt">ul</span> <span class="nt">li</span><span class="p">{</span>
        <span class="k">font-size</span><span class="o">:</span> <span class="m">14px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee-readonly</span><span class="p">{</span>
        <span class="k">display</span><span class="o">:</span> <span class="k">block</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span><span class="nc">.completed</span><span class="nd">:hover</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee-readonly</span><span class="p">{</span>
        <span class="k">display</span><span class="o">:</span> <span class="k">block</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span><span class="nd">:hover</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee-readonly</span><span class="p">{</span>
        <span class="k">display</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee-readonly</span> <span class="nt">span</span><span class="p">{</span>
        <span class="k">font-size</span><span class="o">:</span> <span class="m">14px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee-readonly</span> <span class="nt">i</span><span class="p">{</span>
        <span class="k">margin-top</span><span class="o">:</span> <span class="m">8px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee-readonly</span><span class="p">{</span>
        <span class="k">margin-left</span><span class="o">:</span> <span class="m">45px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nf">#todo-list</span> <span class="nt">li</span><span class="nd">:hover</span> <span class="nt">div</span><span class="nc">.view</span> <span class="nt">div</span><span class="nc">.assignee</span> <span class="nt">a</span><span class="nc">.dropdown-toggle</span><span class="p">{</span>
        <span class="k">margin-left</span><span class="o">:</span> <span class="m">-8px</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>

<h2>License</h2>

<p>MIT License</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/jacor">jacor</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>